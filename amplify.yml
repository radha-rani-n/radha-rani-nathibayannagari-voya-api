version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        - echo "CLERK_PUBLISHABLE_KEY=$CLERK_PUBLISHABLE_KEY" >> .env
        - echo "CLERK_SECRET_KEY=$CLERK_SECRET_KEY" >> .env
        - echo "OPENAI_API_KEY=$OPENAI_API_KEY" >> .env
        - echo "PG_SUPABASE_CONNECTION_STRING=$PG_SUPABASE_CONNECTION_STRING" >> .env
        - echo "PORT=$PORT" >> .env
        - echo "WEATHER_API_KEY=$WEATHER_API_KEY" >> .env
        - echo "ENVIRONMENT=$ENVIRONMENT" >> .env
        - echo "CLERK_SIGNIN_URL=$CLERK_SIGNIN_URL" >> .env
        - echo "CLERK_SIGNUP_URL=$CLERK_SIGNUP_URL" >> .env
        - echo "FRONTEND_URL=$FRONTEND_URL" >> .env
        - echo "API_KEY=$API_KEY" >> .env
        - npm run build
  artifacts:
    baseDirectory: .amplify-hosting
    files:
      - "**/*"
  cache:
    paths:
      - .npm/**/*
      - node_modules/**/*
