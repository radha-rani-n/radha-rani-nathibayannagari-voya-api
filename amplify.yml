version: 1
backend:
  phases:
    preBuild:
      commands:
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        - echo "CLERK_PUBLISHABLE_KEY=$CLERK_PUBLISHABLE_KEY" >> .env
        - echo "CLERK_SECRET_KEY=$CLERK_SECRET_KEY" >> .env
        - echo "CORS_ORIGIN=$CORS_ORIGIN" >> .env
        - echo "OPENAI_API_KEY=$OPENAI_API_KEY" >> .env
        - echo "PG_SUPABASE_CONNECTION_STRING=$PG_SUPABASE_CONNECTION_STRING" >> .env
        - echo "PORT=$PORT" >> .env
        - echo "WEATHER_API_KEY=$WEATHER_API_KEY" >> .env
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - "**/*"
  cache:
    paths:
      - .npm/**/*
